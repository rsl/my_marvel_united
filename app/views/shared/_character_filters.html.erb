<form class="block has-background-info-light py-4 js-filters">
  <div class="is-flex is-justify-content-space-between">
    <div class="field is-horizontal">
      <div class="field-label is-small">
        <div class="label has-text-info">Display</div>
      </div>
      <div class="field-body">
        <div class="field is-narrow">
          <div class="control">
            <div class="select is-info is-small">
              <%= select_tag :character_display, options_for_select(%w[Table Cards], selected: character_display), class: 'has-text-info js-immediate-filter' %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="field is-horizontal">
      <div class="field-label is-small">
        <div class="label has-text-info">Mutant?</div>
      </div>
      <div class="field-body">
        <div class="field is-narrow">
          <div class="control">
            <div class="select is-info is-small">
              <%= select_tag :mutant_status, options_for_select(['Who cares?', 'Yes', 'No'], selected: params[:mutant_status]), class: 'has-text-info js-immediate-filter' %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="field is-horizontal">
      <div class="field-label is-small">
        <div class="label has-text-info">Search</div>
      </div>
      <div class="field-body">
        <div class="field">
          <div class="control">
            <%= text_field_tag :query, params[:query], class: 'input is-small is-info has-text-info', placeholder: 'Character or real name' %>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<script>
  document.addEventListener('turbo:load', () => {
    let immediateFilters = document.querySelectorAll('.js-immediate-filter');

    for (let immediateFilter of immediateFilters) {
      immediateFilter.addEventListener('change', (e) => {
        console.log(document.querySelector('form.js-filters'));
        document.querySelector('form.js-filters').submit();
      });
    }
  });
</script>
